router id 45.32.10.110;

# Define the BGP_VRF table
ipv4 table bgp_vrf;

# Protocol definitions for BGP_VRF
protocol kernel bgp_vrf_kernel {
    vrf "gre_vrf";
    ipv4 {
        import all;
        export all;
        table bgp_vrf;
    };
    kernel table 1000;  # This should match the table ID in your netplan config
}

protocol device bgp_vrf_device {
    scan time 10;
}

protocol direct bgp_vrf_direct {
    vrf "gre_vrf";
    interface "gre*";
    ipv4 {
        import all;
        export all;
        table bgp_vrf;
    };
}

protocol bgp neoprotect_v4_transit {
    vrf "gre_vrf";
    local as 152878;
    source address 172.16.2.206;
    ipv4 {
        table bgp_vrf;
        import none;
        export all;
    };
    graceful restart on;
    neighbor 172.16.2.205 as 199414;
    multihop 255;
}

protocol bgp vultr_v4_transit {
    vrf "gre_vrf";
    local as 152878;
    source address 45.32.10.110;
    ipv4 {
        table bgp_vrf;
        import none;
        export none;
    };
    graceful restart on;
    neighbor 169.254.169.254 as 64515;
    password "8BdZeLmOJyVh0y5C";
    multihop 2;
}

protocol bgp local_v4_peering {
    vrf "gre_vrf";
    local as 152878;
    source address 10.81.82.1;
    ipv4 {
        table bgp_vrf;
        import all;
        export all;
    };
    graceful restart on;
    neighbor 10.81.82.2 as 152878;
    multihop 30;
}

protocol bgp local_v4_peering_2 {
    vrf "gre_vrf";
    local as 152878;
    source address 172.30.100.100;
    ipv4 {
        table bgp_vrf;
        import where net ~ [2.59.252.0/24];
        export where (81, 1) ~ bgp_community || net = 0.0.0.0/0;
    };
    graceful restart on;
    neighbor 172.30.100.1 as 215343;
    multihop;
}

protocol static {
    ipv4 {
        table bgp_vrf;
    };
    route 0.0.0.0/0 unreachable;
}



router id 103.86.45.175;

protocol direct {
    interface "gre*";
    import all;
    export all;
}

protocol bgp vultr_v4_transit {
    local as 152878;
    source address 158.247.248.165;
    import none;
    export filter {
        if (82, 0) ~ bgp_community then {
            accept;
        }
        reject;
    };

    graceful restart on;
    neighbor 10.200.0.133 as 138195;
    multihop 2;
}

protocol bgp moack_v4_transit {
    local as 152878;
    source address 10.200.0.134;
    import none;
    export filter {
        if (82, 0) ~ bgp_community then {
            accept;
        }
        reject;
    };

    graceful restart on;
    neighbor 10.200.0.133 as 138195;
    multihop 2;
}

protocol bgp edge_kr_v4_peering {
    local as 152878;
    source address 10.82.82.2;
    import all;
    export all;
    graceful restart on;
    neighbor 10.82.82.1 as 152878;
    multihop 30;
}

protocol kernel {
    learn;
    persist;
    scan time 20;
    import all;
    export all;
    kernel table 254;
}


protocol device {
    scan time 10;
    export all;
}

protocol bgp pop_kr_v4_peering {
    local as 152878;
    source address 10.82.82.1;
    import all;
    export filter {
        if proto = "announcements" then {
            bgp_community.add((82, 0));
            accept;
        }
        reject;
    };
    graceful restart on;
    hold time 30;
    neighbor 10.82.82.2 as 152878;
    multihop 30;
}







router id 158.247.248.165;

protocol static announcements {
        ipv4 {
                import all;
        };
        include "/etc/bird/announcements.conf";
}

protocol direct {
        interface "gre*";
        ipv4 {
                import all;
                export all;
        };
}

protocol bgp vultr_v4_transit {
        local as 152878;
        source address 158.247.248.165;
        graceful restart on;
        neighbor 169.254.169.254 as 64515;
        password "8BdZeLmOJyVh0y5C";
        multihop 2;
        ipv4 {
                import none;
                export filter {
                        if proto = "announcements" then accept;
                        reject;
                };
        };
}
protocol kernel {
        learn;
        persist;
        scan time 20;
        ipv4 {
                import all;
                export all;
        };
}


protocol device {
        scan time 10;
}